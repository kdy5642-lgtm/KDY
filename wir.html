<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>대공 PKG3 WIR 현황</title>

<style>
    * { box-sizing: border-box; }
    body {
        margin: 0;
        background: #f5f6fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 10px 40px;
    }

    /* 상단 제목 */
    .top-title {
        font-size: 26px;
        font-weight: 700;
        padding: 16px 4px 8px;
    }

    /* 검색바 고정 영역 */
    .search-bar-wrap {
        position: sticky;
        top: 0;
        background: #f5f6fa;
        padding: 8px 0 4px;
        z-index: 1000;
    }

    .search-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
    }

    /* 검색창 */
    .search-input {
        flex: 1;
        padding: 10px 14px;
        font-size: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        outline: none;
    }

    /* 뒤로가기 버튼 */
    .back-btn {
        background: #2563eb;
        border: none;
        padding: 10px 16px;
        font-size: 15px;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        white-space: nowrap;
    }

    /* 테이블 전체 영역 */
    .table-wrapper {
        margin-top: 4px;
        overflow-x: auto;
        background: #ffffff;
        position: relative;
    }

    /* NOTE 컬럼 포함한 전체 grid 구조 */
    .table-row {
        display: grid;
        grid-template-columns:
            80px   /* INDEX */
            360px  /* ISO */
            70px   /* Joint */
            120px  /* W/D No */
            120px  /* Date */
            1fr;   /* Note */
        padding: 4px 8px;
        border-bottom: 1px solid #eee;
        background: white;
        align-items: center;
        font-size: 15px;
        min-width: 880px;
    }

    /* 헤더 */
    .table-header {
        border-top: 1px solid #ddd;
        border-bottom: 2px solid #ddd;
        background: #f3f6ff;
        font-weight: 700;

        position: sticky;
        top: 0;
        z-index: 10;
    }

    .table-header div {
        text-align: center;
    }

    /* 홀짝 구분 */
    #tableBody .table-row:nth-child(even) {
        background: #fafafa;
    }

    /* 숫자/코드 칼럼 기본 정렬 */
    #tableBody .table-row > div:nth-child(1),
    #tableBody .table-row > div:nth-child(3),
    #tableBody .table-row > div:nth-child(4),
    #tableBody .table-row > div:nth-child(5) {
        text-align: center;
    }

    .note-cell {
        color: #999;
        padding-left: 8px;
        text-align: left;
    }

    /* 줄바꿈 포함된 셀 자동 왼쪽정렬 */
    .has-newline {
        text-align: left !important;
        white-space: pre-line !important;
    }

    /* 행 호버 */
    #tableBody .table-row:hover {
        background: #eaf1ff;
        transition: 0.15s;
    }

    /* 선택된 행 */
    #tableBody .table-row.selected {
        background: #ffe9a3 !important;
        box-shadow: inset 0 0 0 2px #f4b400;
        font-weight: 600;
    }

    /* 로딩 오버레이 */
    #loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255,255,255,0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 3000;
        font-size: 16px;
        font-weight: 500;
        display: none;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 4px solid rgba(0,0,0,0.1);
        border-top-color: #2563eb;
        animation: spin 0.8s linear infinite;
        margin-bottom: 8px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* 모바일 전용: ISO를 항상 3줄 고정 + 왼쪽정렬 */
    @media (max-width: 768px) {
        .iso-cell {
            white-space: pre-line !important;
            line-height: 1.2;
            height: calc(1.2em * 3);
            overflow: hidden;
            text-align: left !important;
        }
    }
</style>
</head>

<body>
<div id="loading-overlay">
    <div class="spinner"></div>
    <div>로딩 중...</div>
</div>

<div class="container">
    <div class="top-title">대공 PKG3 WIR 현황</div>

    <div class="search-bar-wrap">
        <div class="search-row">
            <input id="searchInput" class="search-input"
                placeholder="예: 0001, 00701, DK-GW-048, 20250113 등">
            <button class="back-btn" onclick="history.back()">뒤로가기</button>
        </div>
    </div>

    <div class="table-wrapper">
        <div class="table-header table-row">
            <div>INDEX</div>
            <div>ISO 도면번호</div>
            <div>Joint</div>
            <div>W/D No</div>
            <div>Date</div>
            <div>Note</div>
        </div>

        <div id="tableBody"></div>
    </div>
</div>

<script>
    let wirData = [];

    function showLoading(show) {
        document.getElementById("loading-overlay").style.display = show ? "flex" : "none";
    }

    function hasNewline(text) {
        return text && (text.includes("\n") || text.includes("\\n"));
    }

    async function loadData() {
        try {
            showLoading(true);

            const response = await fetch("wirdata.txt?_=" + Date.now());
            const text = await response.text();

            const lines = text.trim().split("\n");

            wirData = lines.map(line => {
                const parts = line.split(/\t+/);
                return {
                    index: parts[0] || "",
                    iso:   (parts[1] || "").replace(/\\n/g, "\n"),
                    joint: parts[2] || "",
                    wd:    parts[3] || "",
                    date:  parts[4] || ""
                };
            });

            renderTable(wirData);

        } catch (e) {
            console.error(e);
            alert("wirdata.txt 파일을 불러오지 못했습니다.");
        } finally {
            showLoading(false);
        }
    }

    function renderTable(list) {
        const body = document.getElementById("tableBody");
        body.innerHTML = "";

        list.forEach(row => {
            const div = document.createElement("div");
            div.className = "table-row";

            div.innerHTML = `
                <div class="${hasNewline(row.index) ? 'has-newline' : ''}">${row.index}</div>
                <div class="iso-cell ${hasNewline(row.iso) ? 'has-newline' : ''}">${row.iso}</div>
                <div class="${hasNewline(row.joint) ? 'has-newline' : ''}">${row.joint}</div>
                <div class="${hasNewline(row.wd) ? 'has-newline' : ''}">${row.wd}</div>
                <div class="${hasNewline(row.date) ? 'has-newline' : ''}">${row.date}</div>
                <div class="note-cell"></div>
            `;

            div.addEventListener("click", () => {
                document.querySelectorAll("#tableBody .table-row")
                    .forEach(r => r.classList.remove("selected"));
                div.classList.add("selected");
            });

            body.appendChild(div);
        });
    }

    document.getElementById("searchInput").addEventListener("input", function () {
        const q = this.value.trim().toLowerCase();

        if (!q) {
            renderTable(wirData);
            return;
        }

        showLoading(true);

        setTimeout(() => {
            const filtered = wirData.filter(r => {
                const line = (
                    (r.index || "") + " " +
                    (r.iso   || "") + " " +
                    (r.joint || "") + " " +
                    (r.wd    || "") + " " +
                    (r.date  || "")
                ).toLowerCase();
                return line.includes(q);
            });

            renderTable(filtered);
            showLoading(false);
        }, 150);
    });

    loadData();
</script>
</body>
</html>
