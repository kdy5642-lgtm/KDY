<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ëŒ€ê³µ PKG3 WIR í˜„í™©</title>

<style>
    * { box-sizing: border-box; }
    body {
        margin: 0;
        background: #f5f6fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 10px 40px;
    }

    /* ìƒë‹¨ ì œëª© */
    .top-title {
        font-size: 26px;
        font-weight: 700;
        padding: 16px 4px 8px;
    }

    /* ê²€ìƒ‰ë°” ê³ ì • ì˜ì—­ */
    .search-bar-wrap {
        position: sticky;
        top: 0;
        background: #f5f6fa;
        padding: 8px 0 4px;
        z-index: 1000;
    }

    .search-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
    }

    /* ê²€ìƒ‰ì°½ */
    .search-input {
        flex: 1;
        padding: 10px 14px;
        font-size: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        outline: none;
    }

    /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
    .back-btn {
        background: #2563eb;
        border: none;
        padding: 10px 16px;
        font-size: 15px;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        white-space: nowrap;
    }

    /* í…Œì´ë¸” ì „ì²´ ì˜ì—­ (í—¤ë” + ë°”ë”” ê°™ì´ ìŠ¤í¬ë¡¤) */
    .table-wrapper {
        margin-top: 4px;
        overflow-x: auto;      /* ëª¨ë°”ì¼ì—ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
        background: #ffffff;   /* ìš°ì¸¡ìœ¼ë¡œ ë°€ì–´ë„ í° ë°°ê²½ ìœ ì§€ */
        position: relative;    /* sticky í—¤ë” z-index ê¸°ì¤€ */
    }

    /* NOTE ì»¬ëŸ¼ í¬í•¨í•œ ì „ì²´ grid êµ¬ì¡° */
    .table-row {
        display: grid;
        grid-template-columns:
            80px   /* INDEX */
            360px  /* ISO */
            70px   /* Joint */
            120px  /* W/D No */
            120px  /* Date */
            1fr;   /* Note */
        padding: 4px 8px;
        border-bottom: 1px solid #eee;
        background: white;
        align-items: center;
        font-size: 15px;
        min-width: 880px; /* í™”ë©´ë³´ë‹¤ ë„“ì–´ì§€ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ ìƒê¹€ */
    }

    /* í—¤ë” ì¤„ (í…Œì´ë¸” ì•ˆì— ë‘ê³  sticky) */
    .table-header {
        border-top: 1px solid #ddd;
        border-bottom: 2px solid #ddd;
        background: #f3f6ff;
        font-weight: 700;

        position: sticky;
        top: 0;          /* í™”ë©´ ìƒë‹¨ì— ê³ ì • */
        z-index: 10;     /* ë°ì´í„° ì¤„ë³´ë‹¤ ìœ„ë¡œ */
    }

    .table-header div {
        text-align: center; /* í—¤ë” ì „ì²´ ê°€ìš´ë° ì •ë ¬ */
    }

    /* ë°ì´í„° ì¤„ í™€ì§ êµ¬ë¶„ */
    #tableBody .table-row:nth-child(even) {
        background: #fafafa;
    }

    /* ISO ê°€ìš´ë° ì •ë ¬ */
    .iso-cell {
        text-align: center;
    }

    /* ìˆ«ì/ì½”ë“œ ì¹¼ëŸ¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ìš´ë° ì •ë ¬ */
    #tableBody .table-row > div:nth-child(1),
    #tableBody .table-row > div:nth-child(3),
    #tableBody .table-row > div:nth-child(4),
    #tableBody .table-row > div:nth-child(5) {
        text-align: center;
    }

    /* NOTE ì¹¸ */
    .note-cell {
        color: #999;
        padding-left: 8px;
        text-align: left;
    }

    /* í–‰ í˜¸ë²„ í•˜ì´ë¼ì´íŠ¸ */
    #tableBody .table-row:hover {
        background: #eaf1ff;
        transition: 0.15s;
    }

    /* í´ë¦­í•´ì„œ ì„ íƒëœ í–‰(ë…¸ë€ìƒ‰) */
    #tableBody .table-row.selected {
        background: #ffe9a3 !important;
        box-shadow: inset 0 0 0 2px #f4b400;
        font-weight: 600;
    }

    /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
    #loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255,255,255,0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 3000;
        font-size: 16px;
        font-weight: 500;
        display: none;
    }

    /* ë™ê·¸ë€ ë¡œë”© ì¸ë””ì¼€ì´í„° */
    .spinner {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 4px solid rgba(0,0,0,0.1);
        border-top-color: #2563eb;
        animation: spin 0.8s linear infinite;
        margin-bottom: 8px;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
</style>
</head>
<body>
<div id="loading-overlay">
    <div class="spinner"></div>
    <div>ë¡œë”© ì¤‘...</div>
</div>

<div class="container">
    <div class="top-title">ëŒ€ê³µ PKG3 WIR í˜„í™©</div>

    <!-- ğŸ”’ ê²€ìƒ‰ë°”: í•­ìƒ ìƒë‹¨ ê³ ì • -->
    <div class="search-bar-wrap">
        <div class="search-row">
            <input
                id="searchInput"
                class="search-input"
                placeholder="ì˜ˆ: 0001, 00701, DK-GW-048, 20250113 ë“±"
            />
            <button class="back-btn" onclick="history.back()">ë’¤ë¡œê°€ê¸°</button>
        </div>
    </div>

    <!-- í—¤ë” + ë°ì´í„° ì˜ì—­ (ê°™ì´ ê°€ë¡œ ìŠ¤í¬ë¡¤) -->
    <div class="table-wrapper">
        <!-- í—¤ë” ì¤„ -->
        <div class="table-header table-row">
            <div>INDEX</div>
            <div>ISO ë„ë©´ë²ˆí˜¸</div>
            <div>Joint</div>
            <div>W/D No</div>
            <div>Date</div>
            <div>Note</div>
        </div>

        <!-- ë°ì´í„° ì˜ì—­ -->
        <div id="tableBody"></div>
    </div>
</div>

<script>
    let wirData = [];

    // ë¡œë”© ì˜¤ë²„ë ˆì´ ON/OFF
    function showLoading(show) {
        document.getElementById("loading-overlay").style.display = show ? "flex" : "none";
    }

    // TXT ë¡œë“œ
    async function loadData() {
        try {
            showLoading(true);
            const response = await fetch("wirdata.txt?_=" + Date.now());
            const text = await response.text();
            const lines = text.trim().split("\n");

            wirData = lines.map(line => {
                // íƒ­ ê¸°ì¤€ìœ¼ë¡œ íŒŒì‹±
                const parts = line.split(/\t+/);
                return {
                    index: parts[0] || "",
                    iso:   parts[1] || "",
                    joint: parts[2] || "",
                    wd:    parts[3] || "",
                    date:  parts[4] || ""
                };
            });

            renderTable(wirData);
        } catch (e) {
            console.error(e);
            alert("wirdata.txt íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        } finally {
            showLoading(false);
        }
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(list) {
        const body = document.getElementById("tableBody");
        body.innerHTML = "";

        list.forEach(row => {
            const div = document.createElement("div");
            div.className = "table-row";
            div.innerHTML = `
                <div>${row.index}</div>
                <div class="iso-cell">${row.iso}</div>
                <div>${row.joint}</div>
                <div>${row.wd}</div>
                <div>${row.date}</div>
                <div class="note-cell"></div>
            `;

            // í´ë¦­ ì‹œ ë…¸ë€ í•˜ì´ë¼ì´íŠ¸
            div.addEventListener("click", () => {
                document
                    .querySelectorAll("#tableBody .table-row")
                    .forEach(r => r.classList.remove("selected"));
                div.classList.add("selected");
            });

            body.appendChild(div);
        });
    }

    // í†µí•© ê²€ìƒ‰
    document.getElementById("searchInput").addEventListener("input", function () {
        const q = this.value.trim().toLowerCase();
        if (!q) {
            renderTable(wirData);
            return;
        }

        showLoading(true);

        // ì…ë ¥ ì¤‘ì—ë„ ë„ˆë¬´ ê¹œë¹¡ì´ì§€ ì•Šê²Œ ì‚´ì§ ë”œë ˆì´
        setTimeout(() => {
            const filtered = wirData.filter(r => {
                const line = (
                    (r.index || "") + " " +
                    (r.iso   || "") + " " +
                    (r.joint || "") + " " +
                    (r.wd    || "") + " " +
                    (r.date  || "")
                ).toLowerCase();
                return line.includes(q);
            });

            renderTable(filtered);
            showLoading(false);
        }, 150);
    });

    // ì´ˆê¸° ë¡œë“œ
    loadData();
</script>
</body>
</html>
