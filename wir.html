<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ëŒ€ê³µ PKG3 WIR í˜„í™©</title>

<style>
    * { box-sizing: border-box; }
    body {
        margin: 0;
        background: #f5f6fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 10px 40px;
    }

    /* ìƒë‹¨ ì œëª© */
    .top-title {
        font-size: 26px;
        font-weight: 700;
        padding: 16px 4px 8px;
    }

    /* ê²€ìƒ‰ë°” ê³ ì • ì˜ì—­ */
    .search-bar-wrap {
        position: sticky;
        top: 0;
        background: #f5f6fa;
        padding: 8px 0 4px;
        z-index: 1000;
    }

    .search-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
    }

    /* ê²€ìƒ‰ì°½ */
    .search-input {
        flex: 1;
        padding: 10px 14px;
        font-size: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        outline: none;
    }

    /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
    .back-btn {
        background: #2563eb;
        border: none;
        padding: 10px 16px;
        font-size: 15px;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        white-space: nowrap;
    }

    /* í…Œì´ë¸” ì „ì²´ ì˜ì—­ */
    .table-wrapper {
        margin-top: 4px;
        overflow-x: auto;      /* PCì—ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
        background: #ffffff;
        position: relative;
    }

    /* ê¸°ë³¸ grid êµ¬ì¡° (PC ê¸°ì¤€) */
    .table-row {
        display: grid;
        grid-template-columns:
            80px   /* INDEX */
            360px  /* ISO */
            70px   /* Joint */
            120px  /* W/D No */
            120px  /* Date */
            1fr;   /* Note */
        padding: 4px 8px;
        border-bottom: 1px solid #eee;
        background: white;
        align-items: center;
        font-size: 15px;
        min-width: 880px; /* PCì—ì„œëŠ” ë„“ê²Œ, ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
    }

    /* í—¤ë” ì¤„ */
    .table-header {
        border-top: 1px solid #ddd;
        border-bottom: 2px solid #ddd;
        background: #f3f6ff;
        font-weight: 700;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .table-header div {
        text-align: center;
    }

    /* í™€ì§ ë°°ê²½ */
    #tableBody .table-row:nth-child(even) {
        background: #fafafa;
    }

    /* ìˆ«ì/ì½”ë“œ ì¹¼ëŸ¼ ê¸°ë³¸ ê°€ìš´ë° ì •ë ¬ */
    #tableBody .table-row > div:nth-child(1),
    #tableBody .table-row > div:nth-child(3),
    #tableBody .table-row > div:nth-child(4),
    #tableBody .table-row > div:nth-child(5) {
        text-align: center;
    }

    .iso-cell {
        text-align: center;
        white-space: nowrap;
    }

    .note-cell {
        color: #999;
        padding-left: 8px;
        text-align: left;
    }

    /* ì¤„ë°”ê¿ˆ(ê°œí–‰) í¬í•¨ëœ ì…€ì€ ì™¼ìª½ ì •ë ¬ + ì¤„ë°”ê¿ˆ í‘œì‹œ */
    .has-newline {
        text-align: left !important;
        white-space: pre-line !important;
    }

    /* í–‰ í˜¸ë²„ */
    #tableBody .table-row:hover {
        background: #eaf1ff;
        transition: 0.15s;
    }

    /* ì„ íƒëœ í–‰ */
    #tableBody .table-row.selected {
        background: #ffe9a3 !important;
        box-shadow: inset 0 0 0 2px #f4b400;
        font-weight: 600;
    }

    /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
    #loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255,255,255,0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 3000;
        font-size: 16px;
        font-weight: 500;
        display: none;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 4px solid rgba(0,0,0,0.1);
        border-top-color: #2563eb;
        animation: spin 0.8s linear infinite;
        margin-bottom: 8px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* =========================
       ğŸ“± ëª¨ë°”ì¼ ì „ìš© ë ˆì´ì•„ì›ƒ
       - í™”ë©´ í­ì— ë§ê²Œ ê°€ë³€ ë¹„ìœ¨
       - INDEX ~ DATEê¹Œì§€ í•œ í™”ë©´ì—
       - NOTE ì»¬ëŸ¼ì€ í­ 0ìœ¼ë¡œ ìˆ¨ê¹€
       ========================= */
    @media (max-width: 768px) {
        .table-wrapper {
            overflow-x: hidden;      /* ê¸°ë³¸ì ìœ¼ë¡œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ìˆ¨ê¹€ */
        }

        .table-row {
            min-width: 100%;         /* í™”ë©´í­ì— ë§ê²Œ */
            grid-template-columns:
                0.7fr   /* INDEX  */
                2.4fr   /* ISO    */
                0.9fr   /* JOINT  */
                1.1fr   /* W/D No */
                1.1fr   /* DATE   */
                0fr;    /* NOTE -> í­ 0 */
        }

        /* ISOëŠ” ëª¨ë°”ì¼ì—ì„œ ìë™ ì¤„ë°”ê¿ˆ + ì™¼ìª½ì •ë ¬ */
        .iso-cell {
            white-space: normal;
            text-align: left;
        }

        /* NOTE ì…€ ë‚´ìš©ì€ ì•ˆ ë³´ì´ê²Œ (í­ë„ 0ì´ì§€ë§Œ í˜¹ì‹œ ëª°ë¼ì„œ) */
        .table-row > div:nth-child(6) {
            overflow: hidden;
        }

        /* í—¤ë”ë„ ê°™ì€ ë¹„ìœ¨ë¡œ ë§ì¶”ê¸° */
        .table-header {
            grid-template-columns:
                0.7fr
                2.4fr
                0.9fr
                1.1fr
                1.1fr
                0fr;
        }
    }
</style>
</head>

<body>
<div id="loading-overlay">
    <div class="spinner"></div>
    <div>ë¡œë”© ì¤‘...</div>
</div>

<div class="container">
    <div class="top-title">ëŒ€ê³µ PKG3 WIR í˜„í™©</div>

    <!-- ê²€ìƒ‰ë°” (ìƒë‹¨ ê³ ì •) -->
    <div class="search-bar-wrap">
        <div class="search-row">
            <input
                id="searchInput"
                class="search-input"
                placeholder="ì˜ˆ: 0001, 00701, DK-GW-048, 20250113 ë“±"
            />
            <button class="back-btn" onclick="history.back()">ë’¤ë¡œê°€ê¸°</button>
        </div>
    </div>

    <!-- í—¤ë” + ë°ì´í„° ì˜ì—­ -->
    <div class="table-wrapper">
        <div class="table-header table-row">
            <div>INDEX</div>
            <div>ISO ë„ë©´ë²ˆí˜¸</div>
            <div>Joint</div>
            <div>W/D No</div>
            <div>Date</div>
            <div>Note</div>
        </div>

        <div id="tableBody"></div>
    </div>
</div>

<script>
    let wirData = [];

    function showLoading(show) {
        document.getElementById("loading-overlay").style.display = show ? "flex" : "none";
    }

    function hasNewline(text) {
        return text && (text.includes("\n") || text.includes("\\n"));
    }

    async function loadData() {
        try {
            showLoading(true);

            const response = await fetch("wirdata.txt?_=" + Date.now());
            const text = await response.text();
            const lines = text.trim().split("\n");

            wirData = lines.map(line => {
                const parts = line.split(/\t+/);
                return {
                    index: parts[0] || "",
                    // ISOì— \n ë¬¸ìì—´ì´ ë“¤ì–´ìˆìœ¼ë©´ ì‹¤ì œ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë³€ê²½
                    iso:   (parts[1] || "").replace(/\\n/g, "\n"),
                    joint: parts[2] || "",
                    wd:    parts[3] || "",
                    date:  parts[4] || ""
                };
            });

            renderTable(wirData);
        } catch (e) {
            console.error(e);
            alert("wirdata.txt íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        } finally {
            showLoading(false);
        }
    }

    function renderTable(list) {
        const body = document.getElementById("tableBody");
        body.innerHTML = "";

        list.forEach(row => {
            const div = document.createElement("div");
            div.className = "table-row";

            div.innerHTML = `
                <div class="${hasNewline(row.index) ? 'has-newline' : ''}">${row.index}</div>
                <div class="iso-cell ${hasNewline(row.iso) ? 'has-newline' : ''}">${row.iso}</div>
                <div class="${hasNewline(row.joint) ? 'has-newline' : ''}">${row.joint}</div>
                <div class="${hasNewline(row.wd) ? 'has-newline' : ''}">${row.wd}</div>
                <div class="${hasNewline(row.date) ? 'has-newline' : ''}">${row.date}</div>
                <div class="note-cell"></div>
            `;

            // í´ë¦­ ì‹œ ì„ íƒ í–‰ í•˜ì´ë¼ì´íŠ¸
            div.addEventListener("click", () => {
                document.querySelectorAll("#tableBody .table-row")
                    .forEach(r => r.classList.remove("selected"));
                div.classList.add("selected");
            });

            body.appendChild(div);
        });
    }

    // í†µí•© ê²€ìƒ‰
    document.getElementById("searchInput").addEventListener("input", function () {
        const q = this.value.trim().toLowerCase();

        if (!q) {
            renderTable(wirData);
            return;
        }

        showLoading(true);

        setTimeout(() => {
            const filtered = wirData.filter(r => {
                const line = (
                    (r.index || "") + " " +
                    (r.iso   || "") + " " +
                    (r.joint || "") + " " +
                    (r.wd    || "") + " " +
                    (r.date  || "")
                ).toLowerCase();
                return line.includes(q);
            });

            renderTable(filtered);
            showLoading(false);
        }, 150);
    });

    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
    loadData();
</script>
</body>
</html>
