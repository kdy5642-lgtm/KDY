<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ëŒ€ê³µ PKG3 WIR í˜„í™©</title>

<style>
    * { box-sizing: border-box; }
    body {
        margin: 0;
        background: #f5f6fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 10px 40px;
    }

    /* ìƒë‹¨ ì œëª© */
    .top-title {
        font-size: 26px;
        font-weight: 700;
        padding: 16px 4px 8px;
    }

    /* ê²€ìƒ‰ + í—¤ë” ê³ ì • ì˜ì—­ (ì—‘ì…€ í‹€ê³ ì •) */
    .search-bar-wrap {
        position: sticky;
        top: 0;
        background: #f5f6fa;
        padding: 8px 0 4px;
        z-index: 999;
    }

    .search-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
    }

    /* ê²€ìƒ‰ì°½ */
    .search-input {
        flex: 1;
        padding: 10px 14px;
        font-size: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        outline: none;
    }

    /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
    .back-btn {
        background: #2563eb;
        border: none;
        padding: 10px 16px;
        font-size: 15px;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        white-space: nowrap;
    }

    /* í…Œì´ë¸” ì „ì²´ ì˜ì—­ */
    .table-wrapper {
        margin-top: 4px;
        overflow-x: auto;      /* ëª¨ë°”ì¼ì—ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
        background: #ffffff;   /* ìš°ì¸¡ìœ¼ë¡œ ë°€ì–´ë„ í° ë°°ê²½ ìœ ì§€ */
    }

    /* NOTE ì»¬ëŸ¼ í¬í•¨í•œ ì „ì²´ grid êµ¬ì¡° */
    .table-row {
        display: grid;
        grid-template-columns:
            80px       /* INDEX */
            360px      /* ISO */
            70px       /* Joint */
            120px      /* W/D No */
            120px      /* Date */
            1fr;       /* NOTE (ë‚¨ëŠ” ì—¬ë°± ì „ë¶€ ë¨¹ìŒ) */
        padding: 4px 8px;
        border-bottom: 1px solid #eee;
        background: white;
        align-items: center;
        font-size: 15px;
        min-width: 880px;      /* í™”ë©´ë³´ë‹¤ ë„“ì–´ì§€ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ ìƒê¹€ */
    }

    /* í—¤ë” ì¤„ (ê²€ìƒ‰ë°” ì•„ë˜ì— í•­ìƒ ê³ ì •) */
    .table-header {
        border-top: 1px solid #ddd;
        border-bottom: 2px solid #ddd;
        background: #f3f6ff;
        font-weight: 700;
    }
    .table-header div {
        text-align: center;  /* í—¤ë” ì „ì²´ ê°€ìš´ë° ì •ë ¬ */
    }

    /* ë°ì´í„° ì¤„ í™€ì§ êµ¬ë¶„ */
    #tableBody .table-row:nth-child(even) {
        background: #fafafa;
    }

    /* ISO ê¸°ë³¸: PCì—ì„œëŠ” ê°€ìš´ë° ì •ë ¬ */
    .iso-cell {
        text-align: center;
        line-height: 1.3;
    }

    /* ìˆ«ì/ì½”ë“œ ì¹¼ëŸ¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ ê°€ìš´ë° ì •ë ¬ */
    #tableBody .table-row > div:nth-child(1),
    #tableBody .table-row > div:nth-child(3),
    #tableBody .table-row > div:nth-child(4),
    #tableBody .table-row > div:nth-child(5) {
        text-align: center;
    }

    /* NOTE ì¹¸ */
    .note-cell {
        color: #999;
        padding-left: 8px;
        text-align: left;
    }

    /* í–‰ í˜¸ë²„ í•˜ì´ë¼ì´íŠ¸ */
    #tableBody .table-row:hover {
        background: #eaf1ff;
        transition: 0.15s;
    }

    /* í´ë¦­í•´ì„œ ì„ íƒëœ í–‰(ë…¸ë€ìƒ‰) */
    #tableBody .table-row.selected {
        background: #ffe9a3 !important;
        box-shadow: inset 0 0 0 2px #f4b400;
        font-weight: 600;
    }

    /* ë¡œë”© ì˜¤ë²„ë ˆì´ + ì›í˜• ìŠ¤í”¼ë„ˆ */
    #loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255,255,255,0.75);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 3000;
    }
    #loading-overlay .spinner {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        border: 4px solid #d0d4e4;
        border-top-color: #2563eb;
        animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* ------------------- ëª¨ë°”ì¼ ì „ìš© ì„¤ì • ------------------- */
    @media (max-width: 768px) {

        /* ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ stickyë¥¼ ë” ì˜ ë¨¹ê²Œ */
        .search-bar-wrap {
            position: -webkit-sticky;
            position: sticky;
            top: 0;
        }

        /* ISO ì…€: ëª¨ë°”ì¼ì—ì„œëŠ” 2ì¤„, ì™¼ìª½ ì •ë ¬ */
        .iso-cell {
            text-align: left;
            white-space: normal;
            overflow: hidden;
            word-break: break-all;
        }
    }
</style>
</head>
<body>

<div id="loading-overlay">
  <div class="spinner"></div>
</div>

<div class="container">

    <div class="top-title">ëŒ€ê³µ PKG3 WIR í˜„í™©</div>

    <!-- ğŸ”’ ê²€ìƒ‰ + í—¤ë”: í•­ìƒ ìƒë‹¨ ê³ ì • (ì—‘ì…€ í‹€ê³ ì • ëŠë‚Œ) -->
    <div class="search-bar-wrap">
        <div class="search-row">
            <input id="searchInput" class="search-input"
                   placeholder="ì˜ˆ: 0001, 00701, DK-GW-048, 20250113 ë“±" />
            <button class="back-btn" onclick="history.back()">ë’¤ë¡œê°€ê¸°</button>
        </div>

        <!-- í—¤ë” ì¤„ -->
        <div class="table-header table-row">
            <div>INDEX</div>
            <div>ISO ë„ë©´ë²ˆí˜¸</div>
            <div>Joint</div>
            <div>W/D No</div>
            <div>Date</div>
            <div>Note</div>
        </div>
    </div>

    <!-- ë°ì´í„° ì˜ì—­ -->
    <div class="table-wrapper">
        <div id="tableBody"></div>
    </div>
</div>

<script>
let wirData = [];

// ë¡œë”© ì˜¤ë²„ë ˆì´ ON/OFF
function showLoading(show) {
    const overlay = document.getElementById("loading-overlay");
    overlay.style.display = show ? "flex" : "none";
}

// TXT ë¡œë“œ
async function loadData() {
    try {
        showLoading(true);
        const response = await fetch("wirdata.txt?_=" + Date.now());
        const text = await response.text();

        const lines = text.trim().split("\n");
        wirData = lines.map(line => {
            // íƒ­ ê¸°ì¤€ìœ¼ë¡œ íŒŒì‹± (í•„ìš”í•˜ë©´ ê³µë°±/ì‰¼í‘œë„ ì¶”ê°€ ê°€ëŠ¥)
            const parts = line.split(/\t+/);
            return {
                index: parts[0] || "",
                iso:   parts[1] || "",
                joint: parts[2] || "",
                wd:    parts[3] || "",
                date:  parts[4] || ""
            };
        });

        renderTable(wirData);
    } catch (e) {
        console.error(e);
        alert("wirdata.txt íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
    } finally {
        showLoading(false);
    }
}

// ISO ì…€ í°íŠ¸ ìë™ ì¤„ì´ê¸° (ëª¨ë°”ì¼ ì „ìš©)
function adjustIsoForMobile() {
    if (window.innerWidth > 768) return;  // PCëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ

    const baselineLength = "S211-10_SB_ISO-3TK-P-2153-01-030-01".length; // 36
    const isoCells = document.querySelectorAll(".iso-cell");

    isoCells.forEach(cell => {
        // ê¸°ë³¸ í°íŠ¸ì™€ ì¤„ê°„ ì„¤ì •
        let size = 15;
        cell.style.fontSize = size + "px";
        cell.style.lineHeight = "1.3";
        cell.style.whiteSpace = "normal";
        cell.style.overflow = "hidden";

        const text = (cell.textContent || "").trim();
        if (!text) return;

        // ë‘ ì¤„ ë†’ì´ ê¸°ì¤€ ê³„ì‚°
        const lineHeight = parseFloat(getComputedStyle(cell).lineHeight || "19");
        const maxHeight = lineHeight * 2;

        // ê¸°ì¤€ ê¸¸ì´ ì´í•˜ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        if (text.length <= baselineLength) {
            // ê·¸ë˜ë„ í˜¹ì‹œ 2ì¤„ ë„˜ì–´ê°€ë©´ ì¡°ê¸ˆë§Œ ì¤„ì—¬ ë³´ê¸°
            if (cell.scrollHeight > maxHeight) {
                while (cell.scrollHeight > maxHeight && size > 11) {
                    size--;
                    cell.style.fontSize = size + "px";
                }
            }
            return;
        }

        // ê¸°ì¤€ë³´ë‹¤ ê¸¸ë©´ ë‘ ì¤„ì— ë“¤ì–´ê°ˆ ë•Œê¹Œì§€ í°íŠ¸ ì¤„ì„
        while (cell.scrollHeight > maxHeight && size > 10) {
            size--;
            cell.style.fontSize = size + "px";
        }
    });
}

// í…Œì´ë¸” ë Œë”ë§
function renderTable(list) {
    const body = document.getElementById("tableBody");
    body.innerHTML = "";

    list.forEach(row => {
        const div = document.createElement("div");
        div.className = "table-row";
        div.innerHTML = `
            <div>${row.index}</div>
            <div class="iso-cell">${row.iso}</div>
            <div>${row.joint}</div>
            <div>${row.wd}</div>
            <div>${row.date}</div>
            <div class="note-cell"></div>
        `;

        // í´ë¦­ ì‹œ ë…¸ë€ í•˜ì´ë¼ì´íŠ¸
        div.addEventListener("click", () => {
            document.querySelectorAll("#tableBody .table-row")
                .forEach(r => r.classList.remove("selected"));
            div.classList.add("selected");
        });

        body.appendChild(div);
    });

    // ISO í°íŠ¸ ì¡°ì • (ëª¨ë°”ì¼ ì „ìš©)
    adjustIsoForMobile();
}

// í†µí•© ê²€ìƒ‰
document.getElementById("searchInput").addEventListener("input", function () {
    const q = this.value.trim().toLowerCase();

    if (!q) {
        renderTable(wirData);
        return;
    }

    showLoading(true);

    // ì‚´ì§ ë”œë ˆì´ë¥¼ ì¤˜ì„œ ì…ë ¥ ì¤‘ ë¡œë”© í‘œì‹œ ìì—°ìŠ¤ëŸ½ê²Œ
    setTimeout(() => {
        const filtered = wirData.filter(r => {
            const line = (
                (r.index || "") + " " +
                (r.iso   || "") + " " +
                (r.joint || "") + " " +
                (r.wd    || "") + " " +
                (r.date  || "")
            ).toLowerCase();
            return line.includes(q);
        });

        renderTable(filtered);
        showLoading(false);
    }, 150);
});

// í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œì—ë„ ëª¨ë°”ì¼ì—ì„œ ISO í°íŠ¸ ì¬ì¡°ì •
window.addEventListener("resize", adjustIsoForMobile);

// ì´ˆê¸° ë¡œë“œ
loadData();
</script>

</body>
</html>
