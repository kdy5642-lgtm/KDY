<!DOCTYPE html> 
<html lang="ko"> 
<head> 
<meta charset="UTF-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
<title>대공 PKG3 Welding Imformation</title> 

<style> 
* { box-sizing: border-box; } 

body { 
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif; 
  background: #f0f2f5; 
  margin: 0; 
  padding: 0; 
} 

.container { 
  max-width: 980px; 
  margin: 0 auto; 
  background: #ffffff; 
  min-height: 100vh; 
  padding: 12px 14px 40px; 
} 

/* 상단 고정 바 */ 
.top-bar { 
  position: sticky; 
  top: 0; 
  z-index: 999; 
  background: #ffffff; 
  padding: 10px 8px 12px; 
  box-shadow: 0 2px 6px rgba(0,0,0,0.08); 
} 

/* 제목 */ 
.title-row { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  flex-wrap: wrap; 
  gap: 8px; 
} 
h1 { 
  margin: 0; 
  font-size: 20px; 
  font-weight: 700; 
} 
.badge-fast { 
  font-size: 11px; 
  padding: 3px 8px; 
  background: #e6f0ff; 
  border: 1px solid #bdd3ff; 
  color: #2755c7; 
  border-radius: 999px; 
  white-space: nowrap; 
} 

/* 검색 모드 (INDEX / 통합검색) */ 
.search-modes { 
  display: flex; 
  flex-wrap: wrap; 
  gap: 10px 14px; 
  margin: 10px 0 6px; 
} 

.search-modes label { 
  font-size: 14px; 
  display: flex; 
  align-items: center; 
  gap: 4px; 
  padding: 4px 10px; 
  border-radius: 999px; 
  background: #f6f7fb; 
  cursor: pointer; 
} 

.search-modes input[type="radio"] { 
  accent-color: #2563eb; 
} 

/* 검색 입력 */ 
.search-box { 
  width: 100%; 
} 

.search-input-wrapper { 
  position: relative; 
  width: 100%; 
} 

#searchInput { 
  width: 100%; 
  padding: 14px 48px 14px 18px; 
  font-size: 17px; 
  border-radius: 999px; 
  border: 1px solid #ccc; 
  outline: none; 
} 

.clear-btn { 
  position: absolute; 
  right: 16px; 
  top: 50%; 
  transform: translateY(-50%); 
  border: none; 
  background: none; 
  font-size: 22px; 
  cursor: pointer; 
  opacity: 0.5; 
} 
.clear-btn:hover { 
  opacity: 0.9; 
} 

/* 테이블 */ 
table { 
  width: 100%; 
  border-collapse: collapse; 
  font-size: 14px; 
} 
thead { 
  background: #f7f7f9; 
  position: sticky; 
  top: 124px; 
  z-index: 998; 
} 
th, td { 
  padding: 8px 10px; 
  border-bottom: 1px solid #e0e0e0; 
  text-align: center; 
} 
tbody tr:nth-child(odd) { 
  background: #fcfcff; 
} 
tbody tr:hover { 
  background: #eef6ff; 
} 

/* Date 값 있는 행 하이라이트 */ 
tbody tr.date-ok { 
  background: #e4f7e4 !important; 
} 

/* 행 선택 하이라이트 */ 
tbody tr.selected-row { 
  background: #dbeafe !important; 
} 

tbody tr { cursor: pointer; } 

/* PC 전용 뒤로가기 */ 
.pc-back-btn { 
  display: none; 
  margin-top: 18px; 
  padding: 12px 18px; 
  background: #2563eb; 
  color: #fff; 
  text-decoration: none; 
  border-radius: 8px; 
  font-size: 15px; 
  font-weight: 600; 
} 

@media (min-width: 801px) { 
  .pc-back-btn { 
    display: inline-block; 
  } 
} 

/* 로딩 오버레이 */ 
.loading-overlay { 
  position: fixed; 
  inset: 0; 
  background: rgba(255,255,255,0.8); 
  display: none; 
  align-items: center; 
  justify-content: center; 
  z-index: 2000; 
} 
.loading-inner { 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  gap: 12px; 
  padding: 20px 24px; 
  background: #ffffff; 
  border-radius: 12px; 
  box-shadow: 0 10px 25px rgba(0,0,0,0.12); 
} 
.spinner { 
  width: 42px; 
  height: 42px; 
  border-radius: 50%; 
  border: 4px solid #e5e7eb; 
  border-top-color: #2563eb; 
  animation: spin 0.8s linear infinite; 
} 
.loading-text { 
  font-size: 14px; 
  color: #374151; 
} 

@keyframes spin { 
  to { transform: rotate(360deg); } 
} 

/* ============================= */
/*   모바일 전용 레이아웃 조정   */
/* ============================= */
@media (max-width: 800px), (max-height: 500px) {
  /* 배지 숨기기 */
  .badge-fast {
    display: none;
  }

  /* 상단 바를 플렉스로 만들어 재배치 */
  .top-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .title-row {
    width: 100%;
  }

  .search-modes {
    width: 100%;
  }

  /* 검색창 영역을 줄이고 (좌측) */
  .search-box {
    order: 3;
    flex: 1 1 65%;
  }

  /* 뒤로가기 버튼을 오른쪽에 배치 */
  .top-back-btn {
    order: 4;
    flex: 0 0 auto;
    margin-top: 0 !important;
    padding: 10px 12px !important;
    font-size: 13px !important;
    white-space: nowrap;
    align-self: center;
  }

  /* ★ 모바일에서는 PC 뒤로가기 버튼 완전 숨김 */
  .pc-back-btn {
    display: none !important;
  }
}
</style> 
</head> 

<body> 

<!-- 로딩 오버레이 --> 
<div id="loadingOverlay" class="loading-overlay"> 
  <div class="loading-inner"> 
    <div class="spinner"></div> 
    <div class="loading-text">데이터를 불러오는 중입니다...</div> 
  </div> 
</div> 

<div class="container"> 

  <div class="top-bar"> 
    <div class="title-row"> 
      <h1>대공 PKG3 Welding Imformation</h1> 
      <div class="badge-fast">현장 태그 / 타입 빠른 검색</div> 
    </div> 

    <a href="https://kdy5642-lgtm.github.io/KDY/" 
       class="top-back-btn"
       style="display:inline-block; margin-top:10px; padding:10px 16px; 
              background:#2563eb; color:#fff; text-decoration:none; 
              border-radius:8px; font-size:14px;"> 
      ◀ 뒤로가기 
    </a> 

    <div class="search-modes"> 
      <label><input type="radio" name="mode" value="index" checked><span>INDEX 검색</span></label> 
      <label><input type="radio" name="mode" value="all"><span>통합 검색</span></label> 
    </div> 

    <div class="search-box"> 
      <div class="search-input-wrapper"> 
        <input id="searchInput" type="text" placeholder="예: 0001, 00701, 02, 251126 등" /> 
        <button id="clearBtn" class="clear-btn">×</button> 
      </div> 
    </div> 
  </div> 

  <table> 
    <thead> 
      <tr> 
        <th style="width:80px;">INDEX</th> 
        <th>ISO 도면번호</th> 
        <th style="width:160px;">Joint</th> 
        <th style="width:140px;">W/D No</th> 
        <th style="width:160px;">Date</th> 
      </tr> 
    </thead> 
    <tbody id="resultBody"></tbody> 
  </table> 

  <a href="https://kdy5642-lgtm.github.io/KDY/" class="pc-back-btn">◀ 뒤로가기 (PC)</a> 
</div> 

<script> 
let rawData = []; 

function showLoadingOverlay() { 
  const el = document.getElementById("loadingOverlay"); 
  if (el) el.style.display = "flex"; 
} 
function hideLoadingOverlay() { 
  const el = document.getElementById("loadingOverlay"); 
  if (el) el.style.display = "none"; 
} 

function parseTextToData(text) { 
  const lines = text.trim().split("\n"); 
  const parsed = []; 

  for (let i = 0; i < lines.length; i++) { 
    const trimmed = lines[i].trim(); 
    if (!trimmed) continue; 

    let cols = trimmed.split(/[\t, ]+/g); 
    if (cols.length < 5) continue; 

    // ★ 여기서 DATE 컬럼 정리: '-', '–', '—' 등은 전부 빈 값으로 처리
    let dateVal = cols[4] || "";
    let dateTrim = String(dateVal).trim();

    if (
      dateTrim === "-" || 
      dateTrim === "–" || 
      dateTrim === "—" || 
      dateTrim === ""
    ) {
      dateVal = "";
    }

    const row = [
      cols[0],
      cols[1],
      cols[2],
      cols[3],
      dateVal,  // 정리된 DATE
      cols.length >= 6 ? cols.slice(5).join(" ") : ""
    ];

    row._lc = row.slice(0, 5).map(v => String(v).toLowerCase());
    parsed.push(row);
  } 

  return parsed; 
} 

async function loadData() { 
  showLoadingOverlay(); 
  try { 
    const res = await fetch("wir.txt?_=" + Date.now()); 
    const text = await res.text(); 
    rawData = parseTextToData(text); 
    renderList(); 
  } catch (e) { 
    alert("wir.txt 파일을 불러오지 못했습니다."); 
  } finally { 
    hideLoadingOverlay(); 
  } 
} 

function renderList() { 
  const mode = document.querySelector('input[name="mode"]:checked').value; 
  const rawKw = document.getElementById("searchInput").value.trim().toLowerCase(); 
  const normKw = rawKw.replace(/[-_\s]/g, ""); 
  const tbody = document.getElementById("resultBody"); 
  tbody.innerHTML = ""; 

  const frag = document.createDocumentFragment(); 

  for (let row of rawData) { 
    const lc = row._lc; 

    if (rawKw) { 
      let ok = false; 
      if (mode === "index") { 
        ok = lc[0].includes(rawKw) || lc[0].replace(/[-_\s]/g, "").includes(normKw); 
      } else { 
        for (let c = 0; c < lc.length; c++) { 
          if (lc[c].includes(rawKw) || lc[c].replace(/[-_\s]/g, "").includes(normKw)) { 
            ok = true; 
            break; 
          } 
        } 
      } 
      if (!ok) continue; 
    } 

    const tr = document.createElement("tr"); 
    tr.innerHTML = `
      <td>${row[0]}</td>
      <td>${row[1]}</td>
      <td>${row[2]}</td>
      <td>${row[3]}</td>
      <td>${row[4]}</td>
    `;

    // ★ 여기서는 "값이 있으면"만 하이라이트 (이미 '-'는 파싱 단계에서 제거됨)
    if (String(row[4]).trim() !== "") {
      tr.classList.add("date-ok");
    }

    tr.addEventListener("click", () => {
      document.querySelectorAll("#resultBody tr.selected-row")
        .forEach(el => el.classList.remove("selected-row"));
      tr.classList.add("selected-row");

      const link = row[5];
      if (!link) return alert("이 행에는 도면 링크가 등록되어 있지 않습니다.");

      if (!confirm(`아래 ISO 도면을 여시겠습니까?\n\n${row[1]}`)) return;

      if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        window.location.href = link;
      } else {
        window.open(link, "_blank", "noopener");
      }
    });

    frag.appendChild(tr);
  }

  tbody.appendChild(frag);
}

let filterTimer = null;
const searchInputEl = document.getElementById("searchInput");
searchInputEl.addEventListener("input", () => {
  if (filterTimer) clearTimeout(filterTimer);
  filterTimer = setTimeout(renderList, 2000);
});

document.getElementById("clearBtn").addEventListener("click", () => {
  searchInputEl.value = "";
  searchInputEl.focus();
  renderList();
});

document.querySelectorAll('input[name="mode"]').forEach(radio => {
  radio.addEventListener("change", renderList);
});

window.addEventListener("orientationchange", () => {
  showLoadingOverlay();
  setTimeout(() => {
    renderList();
    hideLoadingOverlay();
  }, 500);
});

loadData();
</script>

</body>
</html>
